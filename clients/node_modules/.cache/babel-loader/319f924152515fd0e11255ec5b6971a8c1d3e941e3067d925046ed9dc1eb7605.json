{"ast":null,"code":"import React,{useContext,useState}from\"react\";import useFetch from\"../../hooks/useFetch\";import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import\"./reserve.css\";import{faCircleXmark}from\"@fortawesome/free-solid-svg-icons\";import{SearchContext}from\"../../context/SearchContext\";import axios from\"axios\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const Reserve=_ref=>{var _dates$,_dates$2;let{setOpen,hotelId}=_ref;const[selectedRooms,setSelectedRooms]=useState([]);const{data,loading,error}=useFetch(`${process.env.REACT_APP_BASE_URL}/hotels/room/${hotelId}`);const{dates}=useContext(SearchContext);console.log(dates);const navigate=useNavigate();console.log(\"Hotel ID:\",hotelId);console.log(\"Data from useFetch:\",data);console.log(\"Loading:\",loading);console.log(\"Error:\",error);const getDatesInRange=(startDate,endDate)=>{const start=new Date(startDate);const end=new Date(endDate);const date=new Date(start.getTime());let list=[];while(date<=end){list.push(date.getTime());date.setDate(date.getDate()+1);}return list;};const allDates=dates!==null&&dates!==void 0&&(_dates$=dates[0])!==null&&_dates$!==void 0&&_dates$.startDate&&dates!==null&&dates!==void 0&&(_dates$2=dates[0])!==null&&_dates$2!==void 0&&_dates$2.endDate?getDatesInRange(dates[0].startDate,dates[0].endDate):[];const isAvailable=roomNumber=>{const isFound=roomNumber.unavailableDates.some(date=>allDates.includes(new Date(date).getTime()));console.log(\"unavailableDates:\",roomNumber.unavailableDates);console.log(\"allDates:\",allDates);return!isFound;};const handleSelect=e=>{const checked=e.target.checked;const value=e.target.value;setSelectedRooms(checked?[...selectedRooms,value]:selectedRooms.filter(item=>item!==value));};console.log(selectedRooms);const handleClick=async()=>{try{await Promise.all(selectedRooms.map(roomId=>{const res=axios.put(`${process.env.REACT_APP_BASE_URL}/rooms/availability/${roomId}`,{dates:allDates});return res.data;}));setOpen(false);navigate(\"/\");}catch(error){console.log(error);}};return/*#__PURE__*/_jsx(\"div\",{className:\"reserve\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"rContainer\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCircleXmark,className:\"rClose\",onClick:()=>setOpen(false)}),/*#__PURE__*/_jsx(\"span\",{children:\"Select your rooms:\"}),Array.isArray(data)&&data.map(item=>item&&/*#__PURE__*/_jsxs(\"div\",{className:\"rItem\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rItemInfo\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"rTitle\",children:item.title}),/*#__PURE__*/_jsx(\"div\",{className:\"rDesc\",children:item.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"rMax\",children:[\"Max People: \",/*#__PURE__*/_jsx(\"b\",{children:item.maxPeople})]}),/*#__PURE__*/_jsx(\"div\",{className:\"rPrice\",children:item.price})]}),/*#__PURE__*/_jsx(\"div\",{className:\"rSelectRooms\",children:item.roomNumbers.map(roomNumber=>/*#__PURE__*/_jsxs(\"div\",{className:\"room\",children:[/*#__PURE__*/_jsx(\"label\",{children:roomNumber.number}),/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",value:roomNumber._id,onChange:handleSelect,disabled:!isAvailable(roomNumber)})]}))})]},item._id)),/*#__PURE__*/_jsx(\"button\",{onClick:handleClick,className:\"rButton\",children:\"Reserve Now!\"})]})});};export default Reserve;","map":{"version":3,"names":["React","useContext","useState","useFetch","FontAwesomeIcon","faCircleXmark","SearchContext","axios","useNavigate","jsx","_jsx","jsxs","_jsxs","Reserve","_ref","_dates$","_dates$2","setOpen","hotelId","selectedRooms","setSelectedRooms","data","loading","error","process","env","REACT_APP_BASE_URL","dates","console","log","navigate","getDatesInRange","startDate","endDate","start","Date","end","date","getTime","list","push","setDate","getDate","allDates","isAvailable","roomNumber","isFound","unavailableDates","some","includes","handleSelect","e","checked","target","value","filter","item","handleClick","Promise","all","map","roomId","res","put","className","children","icon","onClick","Array","isArray","title","description","maxPeople","price","roomNumbers","number","type","_id","onChange","disabled"],"sources":["E:/Github/Ticket-booking-application/clients/src/components/reserve/Reserve.jsx"],"sourcesContent":["import React, { useContext, useState } from \"react\"\r\nimport useFetch from \"../../hooks/useFetch\"\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\r\nimport \"./reserve.css\"\r\nimport { faCircleXmark } from \"@fortawesome/free-solid-svg-icons\"\r\nimport { SearchContext } from \"../../context/SearchContext\"\r\nimport axios from \"axios\"\r\nimport  { useNavigate } from \"react-router-dom\"\r\n\r\n\r\n\r\nexport const Reserve = ({setOpen, hotelId}) => {\r\n  const [selectedRooms, setSelectedRooms] = useState([])\r\n  const {data, loading, error} = useFetch(`${process.env.REACT_APP_BASE_URL}/hotels/room/${hotelId}`)\r\n  const {dates} = useContext(SearchContext)\r\n  console.log(dates);\r\n  \r\n  const navigate = useNavigate()\r\n\r\n  console.log(\"Hotel ID:\", hotelId);\r\nconsole.log(\"Data from useFetch:\", data);\r\nconsole.log(\"Loading:\", loading);\r\nconsole.log(\"Error:\", error);\r\n\r\n  const getDatesInRange = (startDate, endDate)=>{\r\n    const start = new Date(startDate)\r\n    const end = new Date(endDate)\r\n    const date = new Date(start.getTime())\r\n\r\n    let list = []\r\n    \r\n    while(date <= end){\r\n      list.push(date.getTime())\r\n      date.setDate(date.getDate() + 1)\r\n    }\r\n    return list\r\n  };\r\n\r\n const allDates = dates?.[0]?.startDate && dates?.[0]?.endDate\r\n    ? getDatesInRange(dates[0].startDate, dates[0].endDate)\r\n    : [];\r\n\r\n const isAvailable = (roomNumber) =>{\r\n  const isFound = roomNumber.unavailableDates.some(date =>\r\n    allDates.includes(new Date(date).getTime())\r\n  )\r\n  console.log(\"unavailableDates:\", roomNumber.unavailableDates);\r\nconsole.log(\"allDates:\", allDates);\r\n  return !isFound\r\n } \r\n \r\n  \r\n  \r\n  \r\n  const handleSelect = (e)=>{\r\n    const checked = e.target.checked\r\n    const value = e.target.value\r\n    setSelectedRooms(\r\n      checked \r\n      ? [...selectedRooms, value]\r\n      : selectedRooms.filter((item)=> item !== value)\r\n    )\r\n                                    \r\n  }\r\n  console.log(selectedRooms);\r\n\r\n\r\n \r\n  const handleClick = async ()=>{\r\n    try {\r\n      await Promise.all(\r\n        selectedRooms.map((roomId)=>{\r\n          const res = axios.put(`${process.env.REACT_APP_BASE_URL}/rooms/availability/${roomId}`,{\r\n            dates:allDates,\r\n          })\r\n          return res.data\r\n        })\r\n      )\r\n      setOpen(false)\r\n      navigate(\"/\")\r\n}\r\n     catch (error) {\r\n      console.log(error);\r\n      \r\n    }\r\n  }\r\n  \r\n    return (\r\n    <div className=\"reserve\">\r\n        <div className=\"rContainer\">\r\n            <FontAwesomeIcon icon={faCircleXmark} className=\"rClose\" onClick={()=> (setOpen(false))}/>\r\n              <span>Select your rooms:</span>\r\n              {Array.isArray(data) && data.map((item)=>(\r\n              item && (\r\n                <div className=\"rItem\" key={item._id}>\r\n\r\n                <div className=\"rItemInfo\">\r\n                <div className=\"rTitle\">{item.title}</div>\r\n                <div className=\"rDesc\">{item.description}</div>\r\n                <div className=\"rMax\">Max People: <b>{item.maxPeople}</b></div>\r\n                <div className=\"rPrice\">{item.price}</div>\r\n                </div>\r\n                <div className=\"rSelectRooms\">\r\n\r\n                  {item.roomNumbers.map(roomNumber=>(\r\n                    <div className=\"room\">\r\n                  <label>{roomNumber.number}</label>\r\n                  <input type=\"checkbox\"  value={roomNumber._id} onChange={handleSelect}\r\n                  disabled={!isAvailable(roomNumber)}/>\r\n                </div>\r\n                  \r\n                ))}\r\n                </div>\r\n                </div>\r\n              )\r\n              \r\n))}\r\n<button onClick={handleClick} className=\"rButton\">Reserve Now!</button>\r\n        </div>\r\n    </div>\r\n  )\r\n}\r\nexport default Reserve"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}